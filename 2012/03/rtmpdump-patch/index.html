<!DOCTYPE html>
<html>

<meta charset='utf-8'>

<title>Make a commit from a patch</title>

<link rel='stylesheet' href='/css/style.css'>
<link rel='stylesheet' href='/css/coderay.css'>

<body>

<h1>
<a href='/'>Steven&rsquo;s Blog</a>
</h1>

<div id='container'>
	
	<h2>Make a commit from a patch</h2>
	
	<div><div class="CodeRay">
  <div class="code"><pre><span class="directive">#!/bin/sh</span>
<span class="comment"># Create a commit from a patch</span>
mingw-get install msys-coreutils
<span class="function">cd</span> /c/home/Steven/Desktop

<span class="comment"># Get my repo</span>
git clone git@github.com<span class="reserved">:</span>svnpenn/rtmpdump.git dir_dest
<span class="function">cd</span> dir_dest
git checkout KSV
<span class="comment"># Empty my repo, except &quot;.git&quot;</span>
<span class="function">echo</span> <span class="string">'Press enter to remove old files'</span><span class="delimiter">;</span> <span class="function">read</span>
rm -r *
<span class="function">cd</span> -

<span class="comment"># Get upstream repo</span>
git clone git<span class="reserved">:</span>//git.ffmpeg.org/rtmpdump dir_source
<span class="function">cd</span> dir_source
git apply ../*.diff <span class="integer">2</span>&gt;nul || git apply -p0 ../*.diff
<span class="comment"># Copy patched files over</span>
<span class="function">echo</span> <span class="string">'Press enter to copy new files'</span><span class="delimiter">;</span> <span class="function">read</span>
cp -r * ../dir_dest
<span class="function">cd</span> -

<span class="comment"># Get author modify time</span>
<span class="instance-variable">modify_time</span>=<span class="shell"><span class="delimiter">$(</span>stat -c %y *.diff<span class="delimiter">)</span></span>
<span class="function">echo</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Modify time (</span><span class="instance-variable">$modify_time</span><span class="content">)</span><span class="content">, press enter</span><span class="delimiter">&quot;</span></span><span class="delimiter">;</span> <span class="function">read</span>

<span class="comment"># Get author</span>
<span class="function">echo</span> <span class="string">'Enter author'</span>
<span class="function">read</span> <span class="instance-variable">author</span>

<span class="comment"># Commit</span>
<span class="function">cd</span> dir_dest
git add -A
git commit --author <span class="string"><span class="delimiter">&quot;</span><span class="instance-variable">$author</span><span class="delimiter">&quot;</span></span> --date <span class="string"><span class="delimiter">&quot;</span><span class="instance-variable">$modify_time</span><span class="delimiter">&quot;</span></span>

</pre></div>
</div>
</div>

<h3 id="links">Links</h3>
<ul>
  <li><a href="http://github.com/svnpenn/dotfiles/blob/master/bash/rtmpdump-patch.sh">github.com/svnpenn/dotfiles/blob/master/bash/rtmpdump-patch.sh</a></li>
</ul>



</div>
</body>
</html>