<!DOCTYPE html>
<html>

<meta charset='utf-8'>

<title>Create RtmpDump Distribution</title>

<link rel='stylesheet' href='/css/style.css'>
<link rel='stylesheet' href='/css/coderay.css'>

<body>

<h1>
<a href='/'>Steven&rsquo;s Blog</a>
</h1>

<div id='container'>
	
	<h2>Create RtmpDump Distribution</h2>
	
	<div><div class="CodeRay">
  <div class="code"><pre><span class="directive">#!/bin/sh</span>
<span class="comment"># Create distribution!</span>

<span class="comment"># Install dependencies</span>
mingw-get install msys-coreutils

<span class="comment"># Install RtmpDump</span>
<span class="function">cd</span> rtmpdump
<span class="instance-variable">rtmpdump_version</span>=<span class="shell">$(git describe --tags)</span>
<span class="comment"># stackoverflow.com/q/1253828</span>
<span class="comment"># rtmpdump_timestamp=$(date -d &quot;$(stat -c %z rtmpdump.exe)&quot;)</span>
<span class="instance-variable">rtmpdump_timestamp</span>=<span class="shell">$(stat -c %z rtmpdump.exe)</span>
<span class="instance-variable">rtmpdump_timestamp</span>=<span class="shell">$(date -d &quot;$rtmpdump_timestamp&quot;)</span>
<span class="instance-variable">distdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="instance-variable">$OLDPWD</span><span class="content">/rtmpdump-$(git describe --tags)</span><span class="delimiter">&quot;</span></span>
mkdir <span class="instance-variable">$distdir</span>

cp rtmpdump.exe <span class="instance-variable">$distdir</span>
cp rtmpgw.exe <span class="instance-variable">$distdir</span>
cp rtmpsrv.exe <span class="instance-variable">$distdir</span>
cp rtmpsuck.exe <span class="instance-variable">$distdir</span>

<span class="function">cd</span> librtmp
cp librtmp.dll <span class="instance-variable">$distdir</span>

<span class="comment"># Compress files</span>
<span class="function">cd</span> <span class="instance-variable">$distdir</span>
<span class="comment"># strip -R .tls -o test.exe rtmpdump.exe</span>
strip *
<span class="comment"># mpress -b rtmpdump.exe</span>
upx -<span class="integer">9</span> *

<span class="comment"># CREATE README</span>
<span class="instance-variable">gcc_version</span>=<span class="shell">$(gcc -dumpversion)</span>

<span class="instance-variable">polarssl_version</span>=<span class="shell">$(cat &lt;&lt;EOF | gcc -E -xc - | tail -1 | tr -d \&quot;
#include &lt;polarssl/version.h&gt;
POLARSSL_VERSION_STRING
EOF)</span>

<span class="instance-variable">zlib_version</span>=<span class="shell">$(cat &lt;&lt;EOF | gcc -E -xc - | tail -1 | tr -d \&quot;
#include &lt;zlib.h&gt;
ZLIB_VERSION
EOF)</span>

cat &gt; README.txt <span class="string"><span class="delimiter">&lt;&lt;EOF</span>
<span class="content">This is a RtmpDump Win32 static build by Steven Penny.

Steven's Home Page: http://svnpenn.github.com

Built on $rtmpdump_timestamp

RtmpDump version $rtmpdump_version

The source code for this RtmpDump build can be found at
http://rtmpdump.mplayerhq.hu

This version of RtmpDump was built on
Window 7 Ultimate Service Pack 1
http://windows.microsoft.com/en-us/windows7/products/home

The toolchain used to compile this RtmpDump was
MinGW: http://sourceforge.net/projects/mingw

The GCC version used to compile this RtmpDump was
GCC $gcc_version: http://gcc.gnu.org

The external libraries compiled into this RtmpDump are
Zlib $zlib_version http://zlib.net
PolarSSL $polarssl_version http://polarssl.org
</span><span class="delimiter">EOF</span></span>
</pre></div>
</div>
</div>


</div>
</body>
</html>